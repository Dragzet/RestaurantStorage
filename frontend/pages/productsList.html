<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products</title>
  <style>
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none; /* Для Chrome и Safari */
      margin: 0; /* Убрать отступы */
  }

  input[type=number] {
      -moz-appearance: textfield; /* Для Firefox */
  }

    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa; /* Светлый фон */
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center; /* Заголовок по центру */
    }

    .products-list {
      display: grid;
      list-style-type: none;
      padding: 0;
      grid-template-columns: repeat(4, 1fr); /* 4 колонки */
      gap: 20px; /* Промежуток между ячейками */
    }

    .product-item {
      background-color: #fff; /* Белый фон */
      border: 1px solid #ddd; /* Светлая рамка */
      border-radius: 8px; /* Закругленные углы */
      padding: 10px;
      display: flex;
      justify-content: center;
      flex-direction: column; /* Вертикальная компоновка */
      align-items: center; /* Центрируем содержимое */
      text-align: center; /* Центрируем текст */
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Легкая тень */
      height: 300px;
      width: 300px;
    }

    .product-image {
      width: 100px; /* Ширина изображения */
      height: 100px; /* Высота изображения */
      object-fit: cover; /* Обрезка, если изображение не подходит */
      border-radius: 4px; /* Закругленные углы для изображения */
    }

    .product-title {
      margin: 10px 0 5px; /* Отступы */
      font-size: 1.2em; /* Размер шрифта заголовка */
    }

    .product-amount {
      color: #666; /* Серый цвет для количества */
      font-size: 0.9em; /* Уменьшаем размер шрифта */
      margin-bottom: 10px; /* Отступ внизу */
    }

    .product-change-input {
      width: 50px; /* Ширина поля ввода */
      margin-bottom: 10px; /* Отступ внизу */
    }

    .btn {
      padding: 10px; /* Отступы для кнопок */
      border: none; /* Убираем рамку */
      border-radius: 4px; /* Закругленные углы для кнопок */
      cursor: pointer; /* Указываем, что кнопки кликабельные */
      margin: 5px; /* Отступы между кнопками */
      color: #fff; /* Цвет текста */
    }

    .add-btn {
      background-color: #007bff; /* Синий цвет для кнопки "Добавить" */
    }

    .delete-btn {
      background-color: #dc3545; /* Красный цвет для кнопки "Удалить" */
    }

    .remove-btn {
      background-color: #dc3545; /* Красный цвет для кнопки "Удалить" */
    }

    .error {
      color: red; /* Цвет для сообщений об ошибках */
      text-align: center; /* Центрируем текст ошибки */
      margin-bottom: 20px; /* Отступ снизу */
    }

    /* Стили для карточки "Добавить новый продукт" */
    .add-product-item {
      background-color: #e7f1ff; /* Цвет фона для карточки */
      border: 2px dashed #007bff; /* Дашированная рамка */
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer; /* Указываем, что карточка кликабельная */
      height: 300px;
      width: 300px; /* Высота карточки */
    }

    .add-product-item:hover {
      background-color: #d0e1ff; /* Цвет при наведении */
    }

    .add-product-title {
      font-size: 1.5em; /* Размер шрифта заголовка карточки */
      color: #007bff; /* Цвет заголовка */
    }
  </style>
</head>
<body>
  <h1>Продукты на складе</h1>
  <div id="error" class="error"></div>
  <ul id="products-list" class="products-list"></ul> <!-- Обновлено на <ul> для списков -->

  <script>
    async function fetchProducts() {
      try {
        const response = await fetch('http://localhost:8080/product');
        if (!response.ok) throw new Error('Network response was not ok');

        const products = await response.json();
        displayProducts(products);
        
      } catch (error) {
        document.getElementById('error').textContent = 'Failed to load products. Please try again later.';
        console.error('Fetch error:', error);
      }
    }

    function displayProducts(products) {
      const productsList = document.getElementById('products-list');
      productsList.innerHTML = ''; // Очистка списка продуктов
      
      console.log(products.length);

      if (!products.length) {
        const addProductItem = document.createElement('li');
        addProductItem.className = 'add-product-item';
        addProductItem.innerHTML = '<h2 class="add-product-title">+</h2>'; // Плюсик

        addProductItem.onclick = () => {
          window.location.href = '/create-product.html'; // Переход на страницу создания нового продукта
        };

        productsList.appendChild(addProductItem);
        return;
      }

      products.forEach(product => {
        const listItem = document.createElement('li');
        listItem.className = 'product-item';
        
        const image = document.createElement('img');
        image.className = 'product-image';
        image.src = product.image;
        image.alt = 'Product image';
        
        const title = document.createElement('h2');
        title.className = 'product-title';
        title.textContent = product.name;
        
        const amount = document.createElement('p');
        amount.className = 'product-amount';
        amount.textContent = `Кол-во: ${product.amount}`;

        const input = document.createElement('input');
        input.type = 'number';
        input.value = 0;
        input.className = 'product-change-input';

        const buttons = document.createElement('div');
        buttons.className = 'product-buttons';

        const changeButton = document.createElement('button');
        changeButton.textContent = 'Add';
        changeButton.className = 'btn add-btn';
        changeButton.onclick = async () => {
          try {
            const response = await fetch(`http://localhost:8080/product`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({name: product.name, amount: product.amount + parseInt(input.value), image: product.image}),
            });
            if (!response.ok) throw new Error('Network response was not ok');

            const updatedProduct = await response.json();
            product.amount = product.amount + parseInt(input.value);
            amount.textContent = `Кол-во: ${product.amount}`;
          } catch (error) {
            document.getElementById('error').textContent = 'Failed to update product. Please try again later.';
            console.error('Fetch error:', error);
          }
        };

        const removeButton = document.createElement('button');
        removeButton.textContent = 'Remove';
        removeButton.className = 'btn remove-btn';
        removeButton.onclick = async () => {
          try {
            const response = await fetch(`http://localhost:8080/product?name=` + product.name, {
              method: 'DELETE',
              headers: {
                'Content-Type': 'application/json',
              },
            });
            if (!response.ok) throw new Error('Network response was not ok');
          } catch (error) {
            document.getElementById('error').textContent = 'Failed to update product. Please try again later.';
            console.error('Fetch error:', error);
          }
        };
        
        listItem.appendChild(image);
        listItem.appendChild(title);
        listItem.appendChild(amount);
        listItem.appendChild(input);
        buttons.appendChild(changeButton);
        buttons.appendChild(removeButton);
        listItem.appendChild(buttons);
        productsList.appendChild(listItem);
      });

      // Добавление карточки для создания нового продукта
      const addProductItem = document.createElement('li');
      addProductItem.className = 'add-product-item';
      addProductItem.innerHTML = '<h2 class="add-product-title">+</h2>'; // Плюсик

      addProductItem.onclick = () => {
        window.location.href = '/create-product.html'; // Переход на страницу создания нового продукта
      };

      productsList.appendChild(addProductItem);
    }

    // Запуск функции для получения продуктов при загрузке страницы
    fetchProducts();
  </script>
</body>
</html>
